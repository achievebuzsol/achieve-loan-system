{% extends "base.html" %}

{% block content %}
<h2 class="mb-4">Create New Loan</h2>

<div class="card">
    <div class="card-body">
        <form method="POST">
            <div class="mb-3">
                <label class="form-label">Select Client</label>
                <select class="form-select" name="client_id" id="client_select" required>
                    {% for client in clients %}
                    <option value="{{ client[0] }}" data-rating="{{ client[2] }}">{{ client[1] }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Principal Amount ($)</label>
                <input type="number" class="form-control" name="principal_amount" step="0.01" required>
            </div>
            <div class="mb-3">
                <label class="form-label">Interest Rate (%)</label>
                <input type="number" class="form-control" name="interest_rate" id="interest_rate" step="0.1" value="15.0" required>
                <small class="text-muted">
                    Base rate: 15%. Client rating may reduce this rate.
                    <span id="rate_info" class="text-info"></span>
                </small>
            </div>
            <div class="mb-3">
                <label class="form-label">Loan Term (Days)</label>
                <input type="number" class="form-control" name="loan_term_days" required>
            </div>
            <button type="submit" class="btn btn-primary">Create Loan</button>
        </form>
    </div>
</div>

<script>
document.getElementById('client_select').addEventListener('change', function() {
    var selected = this.options[this.selectedIndex];
    var rating = selected.getAttribute('data-rating');
    var baseRate = 15.0;
    var discount = (rating - 1) * 0.5;
    var finalRate = Math.max(baseRate - discount, baseRate * 0.75);
    document.getElementById('interest_rate').value = finalRate.toFixed(1);
    document.getElementById('rate_info').textContent = ' (Client rating: ' + rating + '/10, Applied rate: ' + finalRate.toFixed(1) + '%)';
});
</script>
{% endblock %}